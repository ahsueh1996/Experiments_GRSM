# Instuctions
Execute the following in succession on a bare metal ARM or x86 machine. The first set of commands exports settings for spark and instructions for the setup scripts 1-5.sh.

  + export IS_ARM=true                                                         ; export MY_YARN_CORES=92                                                      ; export MY_YARN_MEM=112640                                                 ; export MY_USE_YARN_FOR_SPARK_ON_HADOOP=false     ; export MY_SPARK_EXECUTOR_CORES=10                               ; export MY_SPARK_EXECUTOR_MEMORY=10g                   ; export MY_SPARK_DRIVER_MEMORY=1g                       ; export MY_SPARK_WORKER_CORES=92                             ; export MY_SPARK_WORKER_MEMORY=111g               ; export MY_SPARK_WORKER_INSTANCES=1                  ; export MY_SPARK_EXECUTOR_INSTANCES=9                  ; export MY_SPARK_DAEMON_MEMORY=2g                     ; export MY_SPARK_DEFAULT_PARALLELISM=31           ; export MY_SPARK_SQL_SHUFFLE_PARTITIONS=31    
  
  + echo -e "\e[95m=======================" ; echo "stage 1, stick around for some inputs." ; echo -e "==========================\e[39m" ; sleep 3 ; ssh-keygen -t rsa ; ssh root@localhost mkdir -p .ssh ; cat /root/.ssh/id_rsa.pub | ssh root@localhost 'cat >> /root/.ssh/authorized_keys' ; echo -e "\e[95m=======================" ; echo you may leave now for about 10 minutes, installing dependencies ; echo -e "==========================\e[39m" ; sleep 5 ;  yes 'yes' | yum install git ; yes 'yes' | yum install mercurial ; yes 'yes' | yum group install "Development Tools" ; yes 'yes' | yum install perf ; yes 'yes' | yum install xdg-utils ; mkdir -p /home/hsuehku1 ; cd /home/hsuehku1 ; git clone https://github.com/ahsueh1996/Experiments_GRSM.git ; yes 'yes' | cp /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/xdg-bin/* /bin/ ; mkdir -p /home/hibench-output ; mkdir -p /CMC/kmiecseb ; cd /CMC/kmiecseb ; echo ; echo -e "\e[95m=======================" ; echo "done (git clone, dev tools, xdg and mkdirs). Move to stage 2" ; echo -e "==========================\e[39m" 
  
  + echo -e "\e[95m=======================" ; echo "stage 2, using setup_1.sh, fast 1 min wait" ; echo -e "==========================\e[39m" ; sleep 2 ; sh /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/1.sh ; source ~/.bashrc ; echo -e "\e[95m=======================" ; echo Testing Java ; echo -e "==========================\e[39m" ;  sleep 3 ; java -version ; echo -e "\e[95m=======================" ; echo "Testing maven, you should see a failed build because there are no pom.xml files" ; echo -e "==========================\e[39m" ; sleep 3 ; mvn ; echo -e "\e[95m=======================" ; echo "done (java, mvn) -- check test (2) results. Move to stage 3" ; echo -e "==========================\e[39m"

  + echo -e "\e[95m=======================" ; echo "stage 3, using setup_2.sh, 10 min wait time" ; echo -e "==========================\e[39m" ; sleep 5 ; sh /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/2.sh ; echo -e "\e[95m=======================" ; echo "done (protobuf). Move to stage 4" ; echo -e "==========================\e[39m"

  + echo -e "\e[95m=======================" ; echo "stage 4, using setup_3.sh, very fast" ; echo -e "==========================\e[39m" ; sleep 2 ; cp /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/spark-src/CMC/kmiecseb/hadoop /CMC/kmiecseb/. -r ; sh /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/3.sh ; source ~/.bashrc ; echo -e "\e[95m=======================" ; echo "done (hadoop). Move to stage 5" ; echo -e "==========================\e[39m"

  + echo -e "\e[95m=======================" ; echo "stage 5, using setup_4.sh, fast 45 sec wait" ; echo -e "==========================\e[39m" ; sleep 3 ; echo "doing…" ; cp /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/spark-src/CMC/kmiecseb/spark /CMC/kmiecseb/. -r ; sh /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/4.sh ; echo -e "\e[95m=======================" ; echo Testing Spark ; echo -e "==========================\e[39m" ;  sleep 3 ; sh /CMC/kmiecseb/spark/sbin/start-all.sh ; /CMC/kmiecseb/spark/bin/spark-submit --version ; source ~/.bashrc ; echo -e "\e[95m=======================" ; echo "done (spark) -- check (1) test result. Move to stage 6" ; echo -e "==========================\e[39m"

  + echo -e "\e[95m=======================" ; echo "stage 6, very fast" ; echo -e "==========================\e[39m" ; sleep 2 ; echo "doing…" ; cp /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/spark-src/CMC/kmiecseb/HiBench/ /CMC/kmiecseb/. -r ; yes 'Y' | sh /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/5.sh ; source ~/.bashrc ; echo -e "\e[95m=======================" ; echo "done (HiBench). Move to stage 7" ; echo -e "==========================\e[39m"

  + echo -e "\e[95m=======================" ; echo "stage 7, wait for around 15 sec, after input, you can leave for 1 min until the test (another input necessary then)" ; echo -e "==========================\e[39m" ; sleep 6 ; echo "doing…" ; export SPARK_HOME=/CMC/kmiecseb/spark ; export MY_IP=$(ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}' | cut -f1  -d'/') ; yes 'yes' | cp /CMC/kmiecseb/HiBench/bin/* /bin/. ; yes 'yes' | cp /home/hsuehku1/Experiments_GRSM/jmh-spark/setup/spark-src/CMC/kmiecseb/reset.sh /CMC/kmiecseb/reset.sh ; yes 'yes' | cp /home/hsuehku1/Experiments_GRSM/perf-jmh/mat_mul_java/hsdis-aarch64.so $JAVA_HOME/jre/lib/aarch64/server/. ; cd /CMC/kmiecseb/ ; sh /CMC/kmiecseb/reset.sh ; echo -e "\e[95m=======================" ; echo "Testing hdfs and populating with LR prepare.sh from HiBench" ; echo "you should see a populated hdfs in the end. Stick around for input" ; echo -e "==========================\e[39m" ;  sleep 3 ; sh /CMC/kmiecseb/HiBench/bin/workloads/ml/lr/prepare/prepare.sh hdfs://localhost:9000/HiBench/LR/Input 1000 3000 ; echo ; echo ; echo ; echo ========================== ; hdfs dfs -ls /HiBench/LR/ ; echo -e "\e[95m=======================" ; echo "done (export final env vars) -- check (1) test result. Completed setup" ; echo -e "==========================\e[39m"

# Common Bugs
